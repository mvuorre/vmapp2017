<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Analysis for V&amp;M (2017) • vmapp2017</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../index.html">vmapp2017</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Data Analysis for V&amp;M (2017)</h1>
                        <h4 class="author">Matti Vuorre</h4>
            
            <h4 class="date">2017-05-01</h4>
          </div>

    
    
<div class="contents">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(knitr)
<span class="kw">library</span>(gridExtra)
<span class="kw">library</span>(lme4)
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(brms)
<span class="kw">library</span>(vmapp2017)
knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">message =</span> F)</code></pre></div>
<div id="functions-and-constants" class="section level1">
<h1 class="hasAnchor">
<a href="#functions-and-constants" class="anchor"></a>Functions and constants</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">get_pse &lt;-<span class="st"> </span><span class="cf">function</span>(X, x, c, <span class="dt">scale =</span> <span class="dv">1</span>) {
    <span class="co"># Function to get PSEs </span>
    <span class="co"># X = Matrix of posterior samples (or row of MLEs)</span>
    <span class="co"># x = condition (0 or 1)</span>
    <span class="co"># c = constant (what value ISI is centered on)</span>
    pse &lt;-<span class="st"> </span><span class="op">-</span><span class="st"> </span>( (X[,<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>X[,<span class="dv">3</span>]<span class="op">*</span>x) <span class="op">/</span><span class="st"> </span>(X[,<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>X[,<span class="dv">4</span>]<span class="op">*</span>x) )
    pse &lt;-<span class="st"> </span>(scale <span class="op">*</span><span class="st"> </span>pse) <span class="op">+</span><span class="st"> </span>c
    <span class="kw">return</span>(pse)
}

iters &lt;-<span class="st"> </span><span class="dv">17500</span>
warmups &lt;-<span class="st"> </span><span class="dv">5000</span>
color_vals =<span class="st"> </span><span class="kw">c</span>(<span class="st">"#e41a1c"</span>, <span class="st">"#377eb8"</span>)
alphas &lt;-<span class="st"> </span>.<span class="dv">2</span>

<span class="co"># Estimated models are saved in a local file to save time</span>
<span class="kw">load</span>(<span class="dt">file=</span><span class="st">"../../../~$models.rda"</span>)</code></pre></div>
<p>Use common plotting theme</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(vmisc)
<span class="kw">theme_set</span>(<span class="kw">theme_pub</span>())</code></pre></div>
</div>
<div id="data-preparation" class="section level1">
<h1 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h1>
<p>The data is contained in this package. Here we collapse the illusion data to counts (models estimate faster with collapsed data)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(illusion)
illusion &lt;-<span class="st"> </span>illusion <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(exp, id, condition, cond, interval) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">k =</span> <span class="kw">sum</span>(response, <span class="dt">na.rm=</span>T),
              <span class="dt">n =</span> <span class="kw">n</span>(),
              <span class="dt">exclude =</span> <span class="kw">unique</span>(exclude)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ungroup</span>()</code></pre></div>
</div>
<div id="experiment-1" class="section level1">
<h1 class="hasAnchor">
<a href="#experiment-1" class="anchor"></a>Experiment 1</h1>
<div id="apparent-motion" class="section level2">
<h2 class="hasAnchor">
<a href="#apparent-motion" class="anchor"></a>Apparent Motion</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">( exp1 &lt;-<span class="st"> </span><span class="kw">filter</span>(illusion, exp <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) )</code></pre></div>
<pre><code>## # A tibble: 384 × 8
##      exp    id   condition  cond interval     k     n exclude
##    &lt;chr&gt; &lt;dbl&gt;       &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;   &lt;lgl&gt;
## 1      1   101 involuntary     0       33     9    20   FALSE
## 2      1   101 involuntary     0       50     8    20   FALSE
## 3      1   101 involuntary     0       83     8    20   FALSE
## 4      1   101 involuntary     0      100     6    20   FALSE
## 5      1   101 involuntary     0      133     6    20   FALSE
## 6      1   101 involuntary     0      150     5    20   FALSE
## 7      1   101 involuntary     0      200     4    20   FALSE
## 8      1   101 involuntary     0      300     4    20   FALSE
## 9      1   101   voluntary     1       33    10    20   FALSE
## 10     1   101   voluntary     1       50    10    20   FALSE
## # ... with 374 more rows</code></pre>
<p><img src="Analysis_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>We reject the participants in B.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp1 &lt;-<span class="st"> </span><span class="kw">filter</span>(exp1, exclude <span class="op">==</span><span class="st"> </span>F)
Cc &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">unique</span>(exp1<span class="op">$</span>interval))
exp1<span class="op">$</span>isic &lt;-<span class="st"> </span>( exp1<span class="op">$</span>interval <span class="op">-</span><span class="st"> </span>Cc ) <span class="op">/</span><span class="st"> </span><span class="dv">10</span></code></pre></div>
<div id="glmm-mle-estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#glmm-mle-estimation" class="anchor"></a>GLMM MLE estimation</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp1mle &lt;-<span class="st"> </span><span class="kw">glmer</span>(k<span class="op">/</span>n <span class="op">~</span><span class="st"> </span>isic<span class="op">*</span>condition <span class="op">+</span><span class="st"> </span>(isic<span class="op">*</span>condition<span class="op">|</span>id),
                 <span class="dt">weights =</span> n, <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span>logit), 
                 <span class="dt">data=</span>exp1)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(exp1mle)</code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: k/n ~ isic * condition + (isic * condition | id)
##    Data: exp1
## Weights: n
## 
##      AIC      BIC   logLik deviance df.resid 
##   1256.0   1308.8   -614.0   1228.0      306 
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -2.47676 -0.57691 -0.07241  0.63698  2.81210 
## 
## Random effects:
##  Groups Name                    Variance Std.Dev. Corr             
##  id     (Intercept)             3.32248  1.8228                    
##         isic                    0.01843  0.1358    0.07            
##         conditionvoluntary      0.51110  0.7149   -0.47 -0.23      
##         isic:conditionvoluntary 0.02167  0.1472    0.49 -0.24 -0.47
## Number of obs: 320, groups:  id, 20
## 
## Fixed effects:
##                         Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)             -1.06610    0.41767  -2.553   0.0107 *  
## isic                    -0.29819    0.03363  -8.868   &lt;2e-16 ***
## conditionvoluntary       0.48399    0.19325   2.504   0.0123 *  
## isic:conditionvoluntary -0.01918    0.03860  -0.497   0.6192    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) isic   cndtnv
## isic         0.121              
## cndtnvlntry -0.475 -0.281       
## isc:cndtnvl  0.363 -0.340 -0.189
## convergence code: 0
## Model failed to converge with max|grad| = 0.00229299 (tol = 0.001, component 1)</code></pre>
</div>
<div id="glmm-bayes-estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#glmm-bayes-estimation" class="anchor"></a>GLMM Bayes estimation</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Priors &lt;-<span class="st"> </span><span class="kw">c</span>(
    <span class="kw">set_prior</span>(<span class="st">"normal(0, 100)"</span>, <span class="dt">class =</span> <span class="st">"b"</span>),
    <span class="kw">set_prior</span>(<span class="st">"cauchy(0, 4)"</span>, <span class="dt">class =</span> <span class="st">"sd"</span>)
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp1b &lt;-<span class="st"> </span><span class="kw">brm</span>(k <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(n) <span class="op">~</span><span class="st"> </span>isic<span class="op">*</span>condition <span class="op">+</span><span class="st"> </span>(isic<span class="op">*</span>condition<span class="op">|</span>id),
             <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span>logit), <span class="dt">prior =</span> Priors,
             <span class="dt">data=</span>exp1, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> iters, <span class="dt">warmup =</span> warmups)</code></pre></div>
<pre><code>## Inference for Stan model: binomial(logit) brms-model.
## 4 chains, each with iter=17500; warmup=5000; thin=1; 
## post-warmup draws per chain=12500, total post-warmup draws=50000.
## 
##                            mean se_mean   sd  2.5% 97.5% n_eff Rhat
## b_Intercept               -1.08    0.01 0.49 -2.08 -0.14  8825    1
## b_isic                    -0.30    0.00 0.04 -0.38 -0.22 17651    1
## b_conditionvoluntary       0.51    0.00 0.23  0.07  0.99 21705    1
## b_isic:conditionvoluntary -0.02    0.00 0.05 -0.12  0.07 22646    1
## 
## Samples were drawn using NUTS(diag_e) at Thu Feb 23 10:40:36 2017.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Posterior probability (one-sided p-value)</span>
<span class="kw">mean</span>(<span class="kw">posterior_samples</span>(exp1b, <span class="dt">pars =</span> <span class="st">"b_cond"</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">*</span><span class="st"> </span><span class="fl">100.0</span></code></pre></div>
<pre><code>## [1] 98.758</code></pre>
<p>Population level PSEs</p>
<pre><code>## # A tibble: 3 × 4
##           key         m       lwr       upr
##         &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1  Difference  18.73404  1.809483  37.78756
## 2 Involuntary  94.67529 59.582235 126.39876
## 3   Voluntary 113.40933 84.382228 142.05608</code></pre>
<pre><code>## # A tibble: 3 × 2
##           key      pp
##         &lt;chr&gt;   &lt;dbl&gt;
## 1  Difference 0.98334
## 2 Involuntary 0.99986
## 3   Voluntary 1.00000</code></pre>
</div>
<div id="plot-results" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-results" class="anchor"></a>Plot results</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">e1p4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(exp1psesum, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(key, <span class="kw">rev</span>(m)), m)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">lty=</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr), <span class="dt">width =</span> .<span class="dv">2</span>, <span class="dt">size=</span>.<span class="dv">5</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="st">"PSE (ms)"</span>, 
                       <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>),
                       <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">35</span>, <span class="dv">155</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_x_discrete</span>(<span class="st">"Condition"</span>, 
                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"Voluntary"</span>, <span class="st">"No action"</span>, <span class="st">"Difference"</span>))</code></pre></div>
<p><img src="Analysis_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<p>Throughout, we use red to refer to the passive observation condition, and blue to the voluntary action condition.</p>
<p><img src="Analysis_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
</div>
</div>
<div id="interval-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#interval-estimation" class="anchor"></a>Interval Estimation</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(ie)
ie<span class="op">$</span>isic &lt;-<span class="st"> </span>( ie<span class="op">$</span>interval <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(<span class="kw">unique</span>(ie<span class="op">$</span>interval)) ) <span class="op">/</span><span class="st"> </span><span class="dv">10</span>
ie</code></pre></div>
<pre><code>## # A tibble: 3,011 × 6
##       id condition interval estimate  cond  isic
##    &lt;dbl&gt;     &lt;chr&gt;    &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1    101 voluntary      350      500     1    15
## 2    101 voluntary      250      500     1     5
## 3    101 voluntary      150      400     1    -5
## 4    101 voluntary      150      450     1    -5
## 5    101 voluntary      350      500     1    15
## 6    101 voluntary      250      500     1     5
## 7    101 voluntary      250      450     1     5
## 8    101 voluntary      350      450     1    15
## 9    101 voluntary       50      350     1   -15
## 10   101 voluntary       50      350     1   -15
## # ... with 3,001 more rows</code></pre>
<div id="lmm-mle" class="section level3">
<h3 class="hasAnchor">
<a href="#lmm-mle" class="anchor"></a>LMM MLE</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iemle &lt;-<span class="st"> </span>lmerTest<span class="op">::</span><span class="kw">lmer</span>(estimate <span class="op">~</span><span class="st"> </span>isic<span class="op">*</span>condition <span class="op">+</span><span class="st"> </span>(isic<span class="op">*</span>condition<span class="op">|</span>id),
               <span class="dt">data =</span> ie)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(iemle)</code></pre></div>
<pre><code>## Linear mixed model fit by REML ['merModLmerTest']
## Formula: estimate ~ isic * condition + (isic * condition | id)
##    Data: ie
## 
## REML criterion at convergence: 35132.8
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -5.0022 -0.5597 -0.0718  0.4881  5.3010 
## 
## Random effects:
##  Groups   Name                    Variance  Std.Dev. Corr             
##  id       (Intercept)             5110.4748 71.4876                   
##           isic                       3.3282  1.8243   0.14            
##           conditionvoluntary       855.9967 29.2574   0.10 -0.28      
##           isic:conditionvoluntary    0.9201  0.9592   0.35 -0.13  0.96
##  Residual                         6492.0292 80.5731                   
## Number of obs: 3011, groups:  id, 19
## 
## Fixed effects:
##                         Estimate Std. Error t value
## (Intercept)             257.7719    16.5318  15.593
## isic                      6.5033     0.4580  14.200
## conditionvoluntary      -25.3937     7.3266  -3.466
## isic:conditionvoluntary  -0.3991     0.3428  -1.164
## 
## Correlation of Fixed Effects:
##             (Intr) isic   cndtnv
## isic         0.131              
## cndtnvlntry  0.060 -0.234       
## isc:cndtnvl  0.223 -0.295  0.567</code></pre>
</div>
<div id="lmm-bayes" class="section level3">
<h3 class="hasAnchor">
<a href="#lmm-bayes" class="anchor"></a>LMM Bayes</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ieb &lt;-<span class="st"> </span><span class="kw">brm</span>(estimate <span class="op">~</span><span class="st"> </span>isic<span class="op">*</span>condition <span class="op">+</span><span class="st"> </span>(isic<span class="op">*</span>condition<span class="op">|</span>id),
           <span class="dt">data=</span>ie, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> iters, <span class="dt">warmup =</span> warmups)</code></pre></div>
<pre><code>## Inference for Stan model: gaussian(identity) brms-model.
## 4 chains, each with iter=17500; warmup=5000; thin=1; 
## post-warmup draws per chain=12500, total post-warmup draws=50000.
## 
##                             mean se_mean    sd   2.5%  97.5% n_eff Rhat
## b_Intercept               257.78    0.21 19.01 220.03 295.23  8164    1
## b_isic                      6.50    0.00  0.52   5.47   7.55 18232    1
## b_conditionvoluntary      -25.39    0.05  8.07 -41.37  -9.37 23309    1
## b_isic:conditionvoluntary  -0.40    0.00  0.36  -1.10   0.30 50000    1
## 
## Samples were drawn using NUTS(diag_e) at Thu Feb 23 10:49:21 2017.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Posterior probability (one-sided p-value)</span>
<span class="kw">mean</span>(<span class="kw">posterior_samples</span>(ieb, <span class="dt">pars =</span> <span class="st">"b_cond"</span>) <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></code></pre></div>
<pre><code>## [1] 99.794</code></pre>
</div>
<div id="plot-results-1" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-results-1" class="anchor"></a>Plot results</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_int &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(ie<span class="op">$</span>isic))
iepost &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(ieb, <span class="dt">pars=</span><span class="kw">parnames</span>(ieb)[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])
diffdat &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">intrcpt =</span> <span class="dv">0</span>,
                      <span class="dt">isic =</span> <span class="dv">0</span>,
                      <span class="dt">condition =</span> <span class="dv">1</span>,
                      <span class="dt">intrct =</span> new_int)
<span class="co"># create predictor matrix</span>
Xmat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(diffdat)
<span class="co"># matrix for fitted values</span>
fitmat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">ncol=</span><span class="kw">nrow</span>(iepost), <span class="dt">nrow=</span><span class="kw">nrow</span>(diffdat))
<span class="co"># obtain predicted values for each row</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(iepost)) {
    fitmat[,i] &lt;-<span class="st"> </span>Xmat <span class="op">%*%</span><span class="st"> </span><span class="kw">as.matrix</span>(iepost)[i,]
}
<span class="co"># get quantiles to plot</span>
diffdat<span class="op">$</span>lower &lt;-<span class="st"> </span><span class="kw">apply</span>(fitmat, <span class="dv">1</span>, quantile, <span class="dt">prob=</span><span class="fl">0.025</span>)
diffdat<span class="op">$</span>med &lt;-<span class="st"> </span><span class="kw">apply</span>(fitmat, <span class="dv">1</span>, quantile, <span class="dt">prob=</span><span class="fl">0.5</span>)
diffdat<span class="op">$</span>upper &lt;-<span class="st"> </span><span class="kw">apply</span>(fitmat, <span class="dv">1</span>, quantile, <span class="dt">prob=</span><span class="fl">0.975</span>)
diffdat<span class="op">$</span>variable &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(ie<span class="op">$</span>isic))

e1bp6 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(diffdat, <span class="kw">aes</span>(<span class="dt">x =</span> variable, <span class="dt">y=</span>med)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">lty=</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">1.4</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>lower, <span class="dt">ymax=</span>upper), <span class="dt">width =</span> <span class="fl">1.3</span>, <span class="dt">size=</span>.<span class="dv">3</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="st">"Difference (ms)"</span>, 
                       <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">20</span>, <span class="op">-</span><span class="dv">40</span>, <span class="op">-</span><span class="dv">60</span>, <span class="op">-</span><span class="dv">80</span>),
                       <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">85</span>, <span class="dv">25</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="st">"ISI (ms)"</span>, 
                     <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">15</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">15</span>),
                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"50"</span>, <span class="st">"150"</span>, <span class="st">"250"</span>, <span class="st">"350"</span>),
                     <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">18</span>, <span class="dv">18</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">e1bp7 &lt;-<span class="st"> </span><span class="kw">grid.arrange</span>(
    e1bp5 <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">ggtitle</span>(<span class="st">"A)"</span>),
    e1bp6 <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">ggtitle</span>(<span class="st">"B)"</span>),
    <span class="dt">widths =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">3</span>))</code></pre></div>
<p><img src="Analysis_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
<p><img src="Analysis_files/figure-html/unnamed-chunk-28-1.png" width="672"></p>
</div>
</div>
</div>
<div id="experiment-2" class="section level1">
<h1 class="hasAnchor">
<a href="#experiment-2" class="anchor"></a>Experiment 2</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">( exp2 &lt;-<span class="st"> </span><span class="kw">filter</span>(illusion, exp <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) )</code></pre></div>
<pre><code>## # A tibble: 720 × 8
##      exp    id   condition  cond interval     k     n exclude
##    &lt;chr&gt; &lt;dbl&gt;       &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;   &lt;lgl&gt;
## 1      2   202 involuntary     0        0    17    24   FALSE
## 2      2   202 involuntary     0       13    20    24   FALSE
## 3      2   202 involuntary     0       27    16    24   FALSE
## 4      2   202 involuntary     0       40    19    24   FALSE
## 5      2   202 involuntary     0       53    19    24   FALSE
## 6      2   202 involuntary     0       67    16    24   FALSE
## 7      2   202 involuntary     0       80    13    24   FALSE
## 8      2   202 involuntary     0       93    10    24   FALSE
## 9      2   202 involuntary     0      107    18    24   FALSE
## 10     2   202 involuntary     0      120     7    24   FALSE
## # ... with 710 more rows</code></pre>
<p><img src="Analysis_files/figure-html/unnamed-chunk-30-1.png" width="672"></p>
<p>We reject the participants in B.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp2 &lt;-<span class="st"> </span><span class="kw">filter</span>(exp2, exclude <span class="op">==</span><span class="st"> </span>F)
Cc &lt;-<span class="st"> </span><span class="dv">50</span>  <span class="co"># ISI to center on (around middle)</span>
exp2<span class="op">$</span>isic &lt;-<span class="st"> </span>( exp2<span class="op">$</span>interval <span class="op">-</span><span class="st"> </span>Cc ) <span class="op">/</span><span class="st"> </span><span class="dv">10</span></code></pre></div>
<div id="glmm-mle-estimation-1" class="section level3">
<h3 class="hasAnchor">
<a href="#glmm-mle-estimation-1" class="anchor"></a>GLMM MLE estimation</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp2mle &lt;-<span class="st"> </span><span class="kw">glmer</span>(k<span class="op">/</span>n <span class="op">~</span><span class="st"> </span>isic<span class="op">*</span>condition <span class="op">+</span><span class="st"> </span>(isic<span class="op">*</span>condition<span class="op">|</span>id),
                 <span class="dt">weights=</span>n, <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span>logit), 
                 <span class="dt">data=</span>exp2)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(exp2mle)</code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: k/n ~ isic * condition + (isic * condition | id)
##    Data: exp2
## Weights: n
## 
##      AIC      BIC   logLik deviance df.resid 
##   2945.7   3008.6  -1458.8   2917.7      646 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.6524 -0.6673 -0.0274  0.7371  3.5086 
## 
## Random effects:
##  Groups Name                    Variance Std.Dev. Corr             
##  id     (Intercept)             0.91930  0.9588                    
##         isic                    0.05073  0.2252    0.64            
##         conditionvoluntary      0.26396  0.5138   -0.53 -0.41      
##         isic:conditionvoluntary 0.01289  0.1135   -0.29 -0.45  0.68
## Number of obs: 660, groups:  id, 33
## 
## Fixed effects:
##                         Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)             -0.44381    0.17103  -2.595 0.009462 ** 
## isic                    -0.50168    0.04127 -12.156  &lt; 2e-16 ***
## conditionvoluntary       0.38996    0.10243   3.807 0.000141 ***
## isic:conditionvoluntary  0.01168    0.02630   0.444 0.656854    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) isic   cndtnv
## isic         0.618              
## cndtnvlntry -0.527 -0.374       
## isc:cndtnvl -0.248 -0.474  0.514</code></pre>
</div>
<div id="glmm-bayes-estimation-1" class="section level3">
<h3 class="hasAnchor">
<a href="#glmm-bayes-estimation-1" class="anchor"></a>GLMM Bayes estimation</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp2b &lt;-<span class="st"> </span><span class="kw">brm</span>(k <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(n) <span class="op">~</span><span class="st"> </span>isic<span class="op">*</span>condition <span class="op">+</span><span class="st"> </span>(isic<span class="op">*</span>condition<span class="op">|</span>id),
             <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span>logit), <span class="dt">prior =</span> Priors,
             <span class="dt">data=</span>exp2, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> iters, <span class="dt">warmup =</span> warmups)</code></pre></div>
<pre><code>## Inference for Stan model: binomial(logit) brms-model.
## 4 chains, each with iter=17500; warmup=5000; thin=1; 
## post-warmup draws per chain=12500, total post-warmup draws=50000.
## 
##                            mean se_mean   sd  2.5% 97.5% n_eff Rhat
## b_Intercept               -0.44       0 0.18 -0.79 -0.08  7192    1
## b_isic                    -0.50       0 0.04 -0.59 -0.42 10762    1
## b_conditionvoluntary       0.38       0 0.11  0.17  0.60 16949    1
## b_isic:conditionvoluntary  0.01       0 0.03 -0.05  0.06 27036    1
## 
## Samples were drawn using NUTS(diag_e) at Thu Feb 23 10:53:29 2017.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Posterior probability (one-sided p-value)</span>
<span class="kw">mean</span>(<span class="kw">posterior_samples</span>(exp2b, <span class="dt">pars =</span> <span class="st">"b_cond"</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></code></pre></div>
<pre><code>## [1] 99.936</code></pre>
<p>Population-level PSEs.</p>
<pre><code>## # A tibble: 3 × 4
##           key         m       lwr      upr
##         &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1  Difference  7.669065  3.575212 11.93039
## 2 Involuntary 41.370815 35.199276 48.22684
## 3   Voluntary 49.039880 42.937926 56.04192</code></pre>
<pre><code>## # A tibble: 3 × 2
##           key     pp
##         &lt;chr&gt;  &lt;dbl&gt;
## 1  Difference 0.9995
## 2 Involuntary 1.0000
## 3   Voluntary 1.0000</code></pre>
</div>
<div id="plot-results-2" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-results-2" class="anchor"></a>Plot results</h3>
<p><img src="Analysis_files/figure-html/unnamed-chunk-40-1.png" width="672"></p>
<p><img src="Analysis_files/figure-html/unnamed-chunk-41-1.png" width="672"></p>
</div>
</div>
<div id="experiment-3" class="section level1">
<h1 class="hasAnchor">
<a href="#experiment-3" class="anchor"></a>Experiment 3</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">( exp3 &lt;-<span class="st"> </span><span class="kw">filter</span>(illusion, exp <span class="op">==</span><span class="st"> </span><span class="dv">3</span>) )</code></pre></div>
<pre><code>## # A tibble: 760 × 8
##      exp    id   condition  cond interval     k     n exclude
##    &lt;chr&gt; &lt;dbl&gt;       &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;   &lt;lgl&gt;
## 1      3   302 involuntary     0        0    23    24   FALSE
## 2      3   302 involuntary     0       13    24    24   FALSE
## 3      3   302 involuntary     0       27    24    24   FALSE
## 4      3   302 involuntary     0       40    13    24   FALSE
## 5      3   302 involuntary     0       53    13    24   FALSE
## 6      3   302 involuntary     0       67    12    24   FALSE
## 7      3   302 involuntary     0       80     4    24   FALSE
## 8      3   302 involuntary     0       93     4    24   FALSE
## 9      3   302 involuntary     0      107     2    24   FALSE
## 10     3   302 involuntary     0      120     0    24   FALSE
## # ... with 750 more rows</code></pre>
<p><img src="Analysis_files/figure-html/unnamed-chunk-43-1.png" width="672"></p>
<p>We reject the participants in B.</p>
<div id="glmm-mle-estimation-2" class="section level3">
<h3 class="hasAnchor">
<a href="#glmm-mle-estimation-2" class="anchor"></a>GLMM MLE estimation</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp3mle &lt;-<span class="st"> </span><span class="kw">glmer</span>(k<span class="op">/</span>n <span class="op">~</span><span class="st"> </span>isic<span class="op">*</span>condition <span class="op">+</span><span class="st"> </span>(isic<span class="op">*</span>condition<span class="op">|</span>id),
                 <span class="dt">weights =</span> n, <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span>logit), 
                 <span class="dt">data=</span>exp3)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(exp3mle)</code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: k/n ~ isic * condition + (isic * condition | id)
##    Data: exp3
## Weights: n
## 
##      AIC      BIC   logLik deviance df.resid 
##   3375.7   3440.2  -1673.8   3347.7      726 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.9882 -0.6453  0.0293  0.7307  7.3409 
## 
## Random effects:
##  Groups Name                    Variance Std.Dev. Corr             
##  id     (Intercept)             0.97817  0.9890                    
##         isic                    0.04761  0.2182    0.19            
##         conditionvoluntary      0.44366  0.6661   -0.62 -0.01      
##         isic:conditionvoluntary 0.02776  0.1666   -0.08 -0.57  0.19
## Number of obs: 740, groups:  id, 37
## 
## Fixed effects:
##                         Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)             -0.25511    0.16570  -1.540   0.1237    
## isic                    -0.40656    0.03737 -10.878   &lt;2e-16 ***
## conditionvoluntary       0.25607    0.11812   2.168   0.0302 *  
## isic:conditionvoluntary -0.05164    0.03115  -1.658   0.0973 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) isic   cndtnv
## isic         0.184              
## cndtnvlntry -0.618 -0.023       
## isc:cndtnvl -0.075 -0.576  0.164
## convergence code: 0
## Model failed to converge with max|grad| = 0.00147215 (tol = 0.001, component 1)</code></pre>
</div>
<div id="glmm-bayes-estimation-2" class="section level3">
<h3 class="hasAnchor">
<a href="#glmm-bayes-estimation-2" class="anchor"></a>GLMM Bayes estimation</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp3b &lt;-<span class="st"> </span><span class="kw">brm</span>(k <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(n) <span class="op">~</span><span class="st"> </span>isic<span class="op">*</span>condition <span class="op">+</span><span class="st"> </span>(isic<span class="op">*</span>condition<span class="op">|</span>id),
             <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span>logit), <span class="dt">prior =</span> Priors,
             <span class="dt">data=</span>exp3, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> iters, <span class="dt">warmup =</span> warmups)</code></pre></div>
<pre><code>## Inference for Stan model: binomial(logit) brms-model.
## 4 chains, each with iter=17500; warmup=5000; thin=1; 
## post-warmup draws per chain=12500, total post-warmup draws=50000.
## 
##                             mean se_mean    sd   2.5%  97.5% n_eff Rhat
## b_Intercept               -0.248   0.002 0.178 -0.598  0.101  6657    1
## b_isic                    -0.405   0.000 0.040 -0.486 -0.328  9487    1
## b_conditionvoluntary       0.253   0.001 0.127  0.002  0.503 10594    1
## b_isic:conditionvoluntary -0.055   0.000 0.033 -0.120  0.012 15592    1
## 
## Samples were drawn using NUTS(diag_e) at Thu Feb 23 10:58:10 2017.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Posterior probability (one-sided p-value)</span>
<span class="kw">mean</span>(<span class="kw">posterior_samples</span>(exp3b, <span class="dt">pars =</span> <span class="st">"b_cond"</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></code></pre></div>
<pre><code>## [1] 97.574</code></pre>
<pre><code>## # A tibble: 3 × 4
##           key         m        lwr      upr
##         &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
## 1  Difference  6.281609  0.1284105 12.65075
## 2 Involuntary 43.905706 35.2922935 52.56462
## 3   Voluntary 50.187315 43.9534229 56.85072</code></pre>
<pre><code>## # A tibble: 3 × 2
##           key     pp
##         &lt;chr&gt;  &lt;dbl&gt;
## 1  Difference 0.9772
## 2 Involuntary 1.0000
## 3   Voluntary 1.0000</code></pre>
</div>
<div id="plot-results-3" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-results-3" class="anchor"></a>Plot results</h3>
<p><img src="Analysis_files/figure-html/unnamed-chunk-53-1.png" width="672"></p>
<p><img src="Analysis_files/figure-html/unnamed-chunk-54-1.png" width="672"></p>
</div>
</div>
<div id="experiment-4" class="section level1">
<h1 class="hasAnchor">
<a href="#experiment-4" class="anchor"></a>Experiment 4</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">( exp4 &lt;-<span class="st"> </span><span class="kw">filter</span>(illusion, exp <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) )</code></pre></div>
<pre><code>## # A tibble: 720 × 8
##      exp    id  condition  cond interval     k     n exclude
##    &lt;chr&gt; &lt;dbl&gt;      &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;   &lt;lgl&gt;
## 1      4   403 no_warning     0        0    21    24   FALSE
## 2      4   403 no_warning     0       13    21    24   FALSE
## 3      4   403 no_warning     0       27    16    24   FALSE
## 4      4   403 no_warning     0       40    13    24   FALSE
## 5      4   403 no_warning     0       53    17    24   FALSE
## 6      4   403 no_warning     0       67     8    24   FALSE
## 7      4   403 no_warning     0       80    12    24   FALSE
## 8      4   403 no_warning     0       93     7    24   FALSE
## 9      4   403 no_warning     0      107     5    24   FALSE
## 10     4   403 no_warning     0      120     1    24   FALSE
## # ... with 710 more rows</code></pre>
<p><img src="Analysis_files/figure-html/unnamed-chunk-56-1.png" width="672"></p>
<p>We reject the participants in B.</p>
<div id="glmm-mle-estimation-3" class="section level3">
<h3 class="hasAnchor">
<a href="#glmm-mle-estimation-3" class="anchor"></a>GLMM MLE estimation</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp4mle &lt;-<span class="st"> </span><span class="kw">glmer</span>(k<span class="op">/</span>n <span class="op">~</span><span class="st"> </span>isic<span class="op">*</span>condition <span class="op">+</span><span class="st"> </span>(isic<span class="op">*</span>condition<span class="op">|</span>id),
                 <span class="dt">weights =</span> n, <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span>logit), 
                 <span class="dt">data=</span>exp4)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(exp4mle)</code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: k/n ~ isic * condition + (isic * condition | id)
##    Data: exp4
## Weights: n
## 
##      AIC      BIC   logLik deviance df.resid 
##   2815.3   2878.2  -1393.6   2787.3      646 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.6876 -0.6251  0.0345  0.7519  7.0223 
## 
## Random effects:
##  Groups Name                  Variance Std.Dev. Corr             
##  id     (Intercept)           0.959136 0.9794                    
##         isic                  0.038146 0.1953    0.02            
##         conditionwarning      0.137033 0.3702   -0.07  0.23      
##         isic:conditionwarning 0.008463 0.0920    0.19  0.15  0.06
## Number of obs: 660, groups:  id, 33
## 
## Fixed effects:
##                       Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)            0.03681    0.17399   0.212    0.832    
## isic                  -0.49405    0.03601 -13.721   &lt;2e-16 ***
## conditionwarning      -0.02879    0.08109  -0.355    0.723    
## isic:conditionwarning -0.02762    0.02347  -1.177    0.239    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) isic   cndtnw
## isic         0.015              
## condtnwrnng -0.138  0.178       
## isc:cndtnwr  0.134 -0.065  0.037</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(exp4<span class="op">$</span>id)</code></pre></div>
<pre><code>## 
## 403 404 405 406 407 408 409 410 411 412 413 416 417 418 419 420 421 422 
##  20  20  20  20  20  20  20  20  20  20  20  20  20  20  20  20  20  20 
## 423 424 425 426 428 429 430 431 432 433 434 435 436 437 438 
##  20  20  20  20  20  20  20  20  20  20  20  20  20  20  20</code></pre>
</div>
<div id="glmm-bayes-estimation-3" class="section level3">
<h3 class="hasAnchor">
<a href="#glmm-bayes-estimation-3" class="anchor"></a>GLMM Bayes estimation</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp4b &lt;-<span class="st"> </span><span class="kw">brm</span>(k <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(n) <span class="op">~</span><span class="st"> </span>isic<span class="op">*</span>condition <span class="op">+</span><span class="st"> </span>(isic<span class="op">*</span>condition<span class="op">|</span>id),
             <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span>logit), <span class="dt">prior =</span> Priors,
             <span class="dt">data=</span>exp4, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> iters, <span class="dt">warmup =</span> warmups)</code></pre></div>
<pre><code>## Inference for Stan model: binomial(logit) brms-model.
## 4 chains, each with iter=17500; warmup=5000; thin=1; 
## post-warmup draws per chain=12500, total post-warmup draws=50000.
## 
##                           mean se_mean    sd   2.5%  97.5% n_eff Rhat
## b_Intercept              0.035   0.002 0.194 -0.346  0.414  6430    1
## b_isic                  -0.495   0.000 0.040 -0.575 -0.418 11964    1
## b_conditionwarning      -0.026   0.001 0.089 -0.202  0.148 25845    1
## b_isic:conditionwarning -0.027   0.000 0.025 -0.077  0.021 33775    1
## 
## Samples were drawn using NUTS(diag_e) at Thu Feb 23 11:01:35 2017.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Posterior probability (one-sided p-value)</span>
<span class="kw">mean</span>(<span class="kw">posterior_samples</span>(exp4b, <span class="dt">pars =</span> <span class="st">"b_cond"</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></code></pre></div>
<pre><code>## [1] 38.34</code></pre>
<pre><code>## # A tibble: 3 × 2
##          key      pp
##        &lt;chr&gt;   &lt;dbl&gt;
## 1 Difference 0.38266
## 2 No Warning 1.00000
## 3    Warning 1.00000</code></pre>
<pre><code>## # A tibble: 3 × 4
##          key          m       lwr       upr
##        &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 Difference -0.4917079 -3.880532  2.976048
## 2 No Warning 50.7151923 42.981034 58.508879
## 3    Warning 50.2234844 42.574335 58.167847</code></pre>
</div>
<div id="plot-results-4" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-results-4" class="anchor"></a>Plot results</h3>
<p><img src="Analysis_files/figure-html/unnamed-chunk-66-1.png" width="672"></p>
<p><img src="Analysis_files/figure-html/unnamed-chunk-67-1.png" width="672"></p>
</div>
</div>
<div id="combined-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#combined-analysis" class="anchor"></a>Combined analysis</h1>
<p>We also compared the effect of condition across the Ternus experiments using an interaction term. That is, is the effect of condition greater in experiments 2 and 3, than in experiment 4?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">( fulldata &lt;-<span class="st"> </span>illusion <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(exp <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>, <span class="op">!</span>exclude) )</code></pre></div>
<pre><code>## # A tibble: 2,060 × 8
##      exp    id   condition  cond interval     k     n exclude
##    &lt;chr&gt; &lt;dbl&gt;       &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;   &lt;lgl&gt;
## 1      2   202 involuntary     0        0    17    24   FALSE
## 2      2   202 involuntary     0       13    20    24   FALSE
## 3      2   202 involuntary     0       27    16    24   FALSE
## 4      2   202 involuntary     0       40    19    24   FALSE
## 5      2   202 involuntary     0       53    19    24   FALSE
## 6      2   202 involuntary     0       67    16    24   FALSE
## 7      2   202 involuntary     0       80    13    24   FALSE
## 8      2   202 involuntary     0       93    10    24   FALSE
## 9      2   202 involuntary     0      107    18    24   FALSE
## 10     2   202 involuntary     0      120     7    24   FALSE
## # ... with 2,050 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fulldata<span class="op">$</span>isic &lt;-<span class="st"> </span>( fulldata<span class="op">$</span>interval <span class="op">-</span><span class="st"> </span>Cc ) <span class="op">/</span><span class="st"> </span><span class="dv">10</span></code></pre></div>
<div id="glmm-mle-estimation-4" class="section level2">
<h2 class="hasAnchor">
<a href="#glmm-mle-estimation-4" class="anchor"></a>GLMM MLE Estimation</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fullmle &lt;-<span class="st"> </span><span class="kw">glmer</span>(k<span class="op">/</span>n <span class="op">~</span><span class="st"> </span>isic<span class="op">*</span>cond <span class="op">+</span><span class="st"> </span>exp<span class="op">*</span>isic <span class="op">+</span><span class="st"> </span>exp<span class="op">*</span>cond <span class="op">+</span>
<span class="st">                     </span>(isic<span class="op">*</span>cond<span class="op">|</span>id),
                 <span class="dt">weights=</span>n, <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span>logit), 
                 <span class="dt">data=</span>fulldata)</code></pre></div>
<pre><code>## Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control
## $checkConv, : Model failed to converge with max|grad| = 0.0114011 (tol =
## 0.001, component 1)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(fullmle)</code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: k/n ~ isic * cond + exp * isic + exp * cond + (isic * cond |  
##     id)
##    Data: fulldata
## Weights: n
## 
##      AIC      BIC   logLik deviance df.resid 
##   9130.2   9242.8  -4545.1   9090.2     2040 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.6651 -0.6525  0.0077  0.7289  7.1248 
## 
## Random effects:
##  Groups Name        Variance Std.Dev. Corr             
##  id     (Intercept) 0.93472  0.9668                    
##         isic        0.04454  0.2110    0.27            
##         cond        0.27952  0.5287   -0.45 -0.07      
##         isic:cond   0.01699  0.1304   -0.05 -0.36  0.26
## Number of obs: 2060, groups:  id, 103
## 
## Fixed effects:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -0.41374    0.17236  -2.400 0.016377 *  
## isic        -0.48214    0.03644 -13.230  &lt; 2e-16 ***
## cond         0.35137    0.10233   3.434 0.000595 ***
## exp3         0.15485    0.23977   0.646 0.518390    
## exp4         0.44358    0.24301   1.825 0.067947 .  
## isic:cond   -0.02398    0.01595  -1.504 0.132697    
## isic:exp3    0.06101    0.04922   1.240 0.215137    
## isic:exp4   -0.01421    0.04996  -0.284 0.776073    
## cond:exp3   -0.07537    0.14043  -0.537 0.591464    
## cond:exp4   -0.37480    0.14341  -2.613 0.008962 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##           (Intr) isic   cond   exp3   exp4   isc:cn isc:x3 isc:x4 cnd:x3
## isic       0.267                                                        
## cond      -0.450 -0.015                                                 
## exp3      -0.728 -0.188  0.317                                          
## exp4      -0.708 -0.185  0.317  0.514                                   
## isic:cond -0.022 -0.222  0.134 -0.018  0.004                            
## isic:exp3 -0.195 -0.705 -0.019  0.269  0.137 -0.038                     
## isic:exp4 -0.189 -0.687 -0.010  0.137  0.263 -0.006  0.514              
## cond:exp3  0.332 -0.009 -0.724 -0.455 -0.234 -0.008  0.016  0.007       
## cond:exp4  0.323 -0.005 -0.697 -0.235 -0.457 -0.020  0.009  0.017  0.511
## convergence code: 0
## Model failed to converge with max|grad| = 0.0114011 (tol = 0.001, component 1)</code></pre>
</div>
<div id="glmm-bayes-estimation-4" class="section level2">
<h2 class="hasAnchor">
<a href="#glmm-bayes-estimation-4" class="anchor"></a>GLMM Bayes estimation</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fullb &lt;-<span class="st"> </span><span class="kw">brm</span>(k <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(n) <span class="op">~</span><span class="st"> </span>isic<span class="op">*</span>cond <span class="op">+</span><span class="st"> </span>exp<span class="op">*</span>isic <span class="op">+</span><span class="st"> </span>exp<span class="op">*</span>cond <span class="op">+</span>
<span class="st">                 </span>(isic<span class="op">*</span>cond<span class="op">|</span>id),
             <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span>logit), <span class="dt">prior =</span> Priors,
             <span class="dt">data=</span>fulldata, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> iters, <span class="dt">warmup =</span> warmups, 
             <span class="dt">save_ranef =</span> <span class="ot">FALSE</span>)  <span class="co"># Save space</span></code></pre></div>
<pre><code>##  Family: binomial(logit) 
## Formula: k | trials(n) ~ isic * cond + exp * isic + exp * cond + (isic * cond | id) 
##    Data: fulldata (Number of observations: 2060) 
## Samples: 4 chains, each with iter = 17500; warmup = 5000; thin = 1; 
##          total post-warmup samples = 50000
##    WAIC: Not computed
##  
## Group-Level Effects: 
## ~id (Number of levels: 103) 
##                          Estimate Est.Error l-95% CI u-95% CI Eff.Sample
## sd(Intercept)                1.00      0.08     0.86     1.17      11235
## sd(isic)                     0.22      0.02     0.19     0.26      12578
## sd(cond)                     0.55      0.05     0.46     0.66      17779
## sd(isic:cond)                0.13      0.01     0.11     0.16      20396
## cor(Intercept,isic)          0.26      0.10     0.05     0.45       9725
## cor(Intercept,cond)         -0.43      0.10    -0.60    -0.22      21907
## cor(isic,cond)              -0.05      0.12    -0.28     0.18      14458
## cor(Intercept,isic:cond)    -0.03      0.13    -0.28     0.22      19748
## cor(isic,isic:cond)         -0.33      0.11    -0.54    -0.09      20461
## cor(cond,isic:cond)          0.24      0.13    -0.02     0.48      15893
##                          Rhat
## sd(Intercept)               1
## sd(isic)                    1
## sd(cond)                    1
## sd(isic:cond)               1
## cor(Intercept,isic)         1
## cor(Intercept,cond)         1
## cor(isic,cond)              1
## cor(Intercept,isic:cond)    1
## cor(isic,isic:cond)         1
## cor(cond,isic:cond)         1
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept    -0.41      0.18    -0.77    -0.06       4998    1
## isic         -0.48      0.04    -0.55    -0.41       8096    1
## cond          0.35      0.11     0.15     0.56      10047    1
## exp3          0.16      0.25    -0.33     0.64       4592    1
## exp4          0.45      0.25    -0.05     0.94       4750    1
## isic:cond    -0.03      0.02    -0.06     0.01      23692    1
## isic:exp3     0.06      0.05    -0.04     0.16       7519    1
## isic:exp4    -0.02      0.05    -0.12     0.09       8059    1
## cond:exp3    -0.08      0.14    -0.36     0.21       9778    1
## cond:exp4    -0.38      0.15    -0.67    -0.08      10662    1
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Posterior probability that effect of condition (i.e. warning condition effect is smaller than voluntary action condition effect).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Posterior probability (one-sided p-value)</span>
<span class="kw">mean</span>(<span class="kw">posterior_samples</span>(fullb, <span class="dt">pars =</span> <span class="st">"b_cond:exp4"</span>) <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></code></pre></div>
<pre><code>## [1] 99.4</code></pre>
<p>Compare effect of condition across the three Ternus experiments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(fullb, <span class="dt">pars =</span> <span class="st">"b_cond"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">transmute</span>(<span class="dt">cond_exp2 =</span> b_cond,
              <span class="dt">cond_exp3 =</span> b_cond <span class="op">+</span><span class="st"> </span>b_cond.exp3,
              <span class="dt">cond_exp4 =</span> b_cond <span class="op">+</span><span class="st"> </span>b_cond.exp4,
              <span class="dt">cond_2v3 =</span> b_cond.exp3,
              <span class="dt">cond_2v4 =</span> b_cond.exp4,
              <span class="dt">cond_3v4 =</span> cond_exp4 <span class="op">-</span><span class="st"> </span>cond_exp3)
x <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">bhat =</span> <span class="kw">mean</span>(value),
              <span class="st">`</span><span class="dt">2.5%ile</span><span class="st">`</span> =<span class="st"> </span><span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">0.025</span>),
              <span class="st">`</span><span class="dt">97.5%ile</span><span class="st">`</span> =<span class="st"> </span><span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">0.975</span>))</code></pre></div>
<pre><code>## # A tibble: 6 × 4
##         key        bhat   `2.5%ile`  `97.5%ile`
##       &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1  cond_2v3 -0.07702028 -0.36268402  0.20589888
## 2  cond_2v4 -0.37716975 -0.67038813 -0.08425850
## 3  cond_3v4 -0.30014947 -0.58698900 -0.01374827
## 4 cond_exp2  0.35233824  0.14620466  0.56059514
## 5 cond_exp3  0.27531796  0.07914614  0.47232450
## 6 cond_exp4 -0.02483151 -0.23728027  0.18591864</code></pre>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#functions-and-constants">Functions and constants</a></li>
      <li><a href="#data-preparation">Data preparation</a></li>
      <li>
<a href="#experiment-1">Experiment 1</a><ul class="nav nav-pills nav-stacked">
<li><a href="#apparent-motion">Apparent Motion</a></li>
      <li><a href="#interval-estimation">Interval Estimation</a></li>
      </ul>
</li>
      <li><a href="#experiment-2">Experiment 2</a></li>
      <li><a href="#experiment-3">Experiment 3</a></li>
      <li><a href="#experiment-4">Experiment 4</a></li>
      <li>
<a href="#combined-analysis">Combined analysis</a><ul class="nav nav-pills nav-stacked">
<li><a href="#glmm-mle-estimation-4">GLMM MLE Estimation</a></li>
      <li><a href="#glmm-bayes-estimation-4">GLMM Bayes estimation</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matti Vuorre.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
